<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panneau AR vers l'île Seguin</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
        <!-- Panneau de signalisation -->
        <a-entity id="panneau" position="0 1 -3" rotation="0 0 0">
            <a-box color="red" depth="0.1" height="1" width="2"></a-box>
            <a-text id="distance-text" value="Calcul..." position="0 0.6 0.1" align="center"></a-text>
        </a-entity>
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        // Coordonnées du centre de l'île Seguin
        const cible = { lat: 48.827, lon: 2.234 }; // Remplace avec les vraies coordonnées
        const panneau = document.getElementById("panneau");
        const distanceText = document.getElementById("distance-text");

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Rayon de la Terre en mètres
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance en mètres
        }

        function getBearing(lat1, lon1, lat2, lon2) {
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const λ1 = lon1 * Math.PI / 180;
            const λ2 = lon2 * Math.PI / 180;

            const y = Math.sin(λ2 - λ1) * Math.cos(φ2);
            const x = Math.cos(φ1) * Math.sin(φ2) -
                      Math.sin(φ1) * Math.cos(φ2) * Math.cos(λ2 - λ1);
            return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
        }

        function updatePosition() {
            navigator.geolocation.watchPosition(position => {
                const { latitude, longitude } = position.coords;
                const distance = getDistance(latitude, longitude, cible.lat, cible.lon);
                const bearing = getBearing(latitude, longitude, cible.lat, cible.lon);
                
                // Met à jour la distance affichée
                distanceText.setAttribute("value", `${Math.round(distance)} m`);

                // Tourne le panneau vers la cible
                panneau.setAttribute("rotation", `0 ${bearing} 0`);
            }, error => console.error(error), {
                enableHighAccuracy: true
            });
        }

        updatePosition();
    </script>
</body>
</html>
